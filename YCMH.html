<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Yêu Cầu Mua Hàng - Công ty CP Đầu tư và Xây dựng Âu Việt</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f0f6ff;
            color: #333;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            position: relative; /* Cần cho position absolute của suggestionBox */
        }
        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 71, 171, 0.15);
        }
        .header {
            background: linear-gradient(135deg, #0047AB 0%, #002b6b 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            display: flex; /* Sử dụng flexbox để căn chỉnh logo và text */
            align-items: center; /* Căn giữa theo chiều dọc */
            justify-content: space-between; /* Đẩy logo sang trái, text sang phải */
        }
        .header::before, .header::after { /* Giữ các hiệu ứng nền cũ */
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        .header::after {
            bottom: -80px;
            left: -80px;
            top: auto; /* Hủy bỏ top của ::before */
            right: auto; /* Hủy bỏ right của ::before */
        }
        .logo-container { /* Container cho logo */
            display: flex;
            align-items: center;
            gap: 15px; /* Khoảng cách giữa logo và text */
            flex-shrink: 0; /* Ngăn logo bị co lại */
        }
        .header-logo {
            height: 60px; /* Điều chỉnh chiều cao logo phù hợp */
            width: auto;
            display: block; /* Giúp chiều cao hoạt động tốt */
        }
        .company-info { /* Container cho tên công ty và tiêu đề */
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1; /* Cho phép phần này chiếm không gian còn lại */
        }
        .company-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .document-title {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: 1px;
        }
        .document-code {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 1; /* Đảm bảo nằm trên cùng */
        }
        .search-container {
            padding: 15px 25px;
            background: #e6f0ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .search-box {
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative; /* Cần cho position absolute của suggestionBox */
        }
        .search-input {
            padding: 10px 15px;
            border: 1px solid #0047AB;
            border-radius: 5px;
            font-size: 16px;
            width: 250px; /* Chiều rộng mặc định */
            box-sizing: border-box; /* Đảm bảo padding không làm tăng kích thước */
        }
        /* CSS cho hộp gợi ý */
        #suggestions {
            position: absolute;
            top: 100%; /* Đặt ngay dưới input */
            left: 0;
            background-color: white;
            border: 1px solid #0047AB;
            border-radius: 0 0 5px 5px; /* Bo tròn dưới */
            margin-top: -1px; /* Giúp liền mạch với border input */
            max-height: 200px;
            overflow-y: auto;
            width: 250px; /* Bằng chiều rộng ô input */
            display: none; 
            z-index: 10;
            box-shadow: 0 3px 10px rgba(0, 71, 171, 0.1);
            border-top: none; /* Bỏ border trên để liền với input */
        }
        #suggestions div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 16px;
            transition: background-color 0.2s ease;
        }
        #suggestions div:last-child {
            border-bottom: none; /* Bỏ border dưới cho item cuối */
        }
        #suggestions div:hover {
            background-color: #f0f7ff;
        }

        .search-button {
            background: #0047AB;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        .search-button:hover {
            background: #003580;
        }
        .print-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }
        .print-button:hover {
            background: #218838;
        }
        .content {
            padding: 25px;
        }
        .project-info {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 12px 5px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8fbff;
            border-radius: 8px;
            border-left: 5px solid #0047AB;
        }
        .info-label {
            font-weight: 600;
            color: #0047AB;
            white-space: nowrap;
        }
        .info-value {
            font-weight: 500;
        }
        .request-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .detail-box {
            background: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            min-width: 180px;
            box-shadow: 0 3px 10px rgba(0, 71, 171, 0.08);
            flex: 1; /* Giúp các box giãn nở */
        }
        .detail-label {
            font-size: 14px;
            color: #0047AB;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .detail-value {
            font-size: 18px;
            font-weight: 700;
            color: #002b6b;
        }
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        .items-table th {
            background-color: #0047AB;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
        }
        .items-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        .items-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .items-table tr:hover {
            background-color: #f0f7ff;
        }
        .stt {
            width: 50px;
            text-align: center;
        }
        .quantity, .unit {
            width: 80px;
            text-align: center;
        }
        .date {
            width: 100px;
            text-align: center;
        }
        .signature-area {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            flex-wrap: wrap;
            gap: 20px;
        }
        .signature-box {
            text-align: center;
            flex: 1;
            min-width: 200px;
        }
        .signature-line {
            border-top: 1px solid #0047AB;
            margin: 50px 0 10px;
            padding-top: 5px;
            font-style: italic;
            color: #0047AB;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            padding: 15px;
            background: #f0f7ff;
            color: #0047AB;
            font-size: 14px;
            border-top: 1px solid #d0e5ff;
        }
        .logo { /* Đã đổi tên class này vì nó được dùng ở footer */
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .logo-icon {
            font-size: 32px;
            color: #0047AB;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #0047AB;
            font-size: 18px;
        }
        .loading i {
            font-size: 32px;
            margin-bottom: 15px;
            display: block;
        }
        .error {
            color: #d32f2f;
            text-align: center;
            padding: 20px;
            background: #ffebee;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        .no-data {
            text-align: center;
            padding: 30px;
            color: #666;
            font-style: italic;
            display: none;
        }
        @media (max-width: 768px) {
            .header {
                flex-direction: column; /* Stack logo và text theo chiều dọc */
                align-items: center;
            }
            .logo-container {
                margin-bottom: 15px; /* Khoảng cách dưới logo */
            }
            .company-info {
                width: 100%; /* Cho phép chiếm toàn bộ chiều rộng */
            }
            .document-title {
                font-size: 24px; /* Giảm kích thước tiêu đề */
            }
            .search-container {
                flex-direction: column;
                align-items: stretch;
            }
            .search-box {
                width: 100%;
            }
            .search-input {
                width: 100%;
            }
            #suggestions {
                width: 100%; /* Chiều rộng 100% trên màn hình nhỏ */
            }
            .request-details {
                flex-direction: column;
            }
            .detail-box {
                width: 100%;
            }
            .items-table {
                display: block;
                overflow-x: auto;
            }
            .signature-area {
                flex-direction: column;
            }
        }
        /* --- CSS cho chế độ in --- */
        @media print {
            body {
                background: white; /* Nền trắng khi in */
                margin: 0;
                padding: 0;
                font-family: "Times New Roman", Times, serif; /* Font chữ dễ đọc trên giấy */
                font-size: 12pt; /* Kích thước font mặc định cho in */
            }
            .container {
                box-shadow: none; /* Bỏ shadow khi in */
                border-radius: 0; /* Bỏ bo góc */
                width: 100%;
                max-width: 100%; /* Chiếm toàn bộ chiều rộng */
            }
            .header {
                background: linear-gradient(135deg, #0047AB 0%, #002b6b 100%); /* Giữ màu header */
                -webkit-print-color-adjust: exact; /* Đảm bảo màu sắc được in */
                print-color-adjust: exact;
                display: flex; /* Đảm bảo layout flex cho header */
                align-items: center;
                justify-content: space-between; /* Phân bố không gian */
                padding: 10px 20px; /* Padding nhỏ hơn khi in */
            }
            .header::before, .header::after { /* Ẩn các hiệu ứng nền khi in */
                display: none;
            }
            .logo-container {
                gap: 10px; /* Giảm khoảng cách */
            }
            .header-logo {
                height: 50px; /* Chiều cao logo khi in */
            }
            .company-info {
                flex-grow: 1;
                align-items: center; /* Căn giữa nội dung */
            }
            .company-name {
                font-size: 16pt; /* Kích thước font */
                margin-bottom: 3px;
            }
            .document-title {
                font-size: 18pt; /* Kích thước font */
                letter-spacing: 0.5px;
            }
            .document-code {
                display: none; /* Ẩn mã tài liệu khi in */
            }

            .search-container, /* Ẩn các thành phần tìm kiếm và điều khiển */
            .loading,
            .error,
            .no-data,
            .footer {
                display: none !important; /* Quan trọng: ẩn các mục này */
            }
            .content {
                padding: 10px 20px; /* Giảm padding nội dung */
            }
            .project-info {
                border-left: 3px solid #0047AB; /* Giảm độ dày border */
                padding: 15px;
                margin-bottom: 20px;
                grid-template-columns: auto 1fr; /* Giữ nguyên định dạng grid */
            }
            .info-label {
                font-size: 11pt; /* Giảm font cho label */
                color: #0047AB; /* Giữ màu cho label */
            }
            .info-value {
                font-size: 12pt; /* Giảm font cho giá trị */
                font-weight: 500;
            }
            .request-details {
                gap: 10px; /* Giảm khoảng cách giữa các detail box */
                margin-bottom: 15px;
                flex-wrap: wrap;
            }
            .detail-box {
                background: #f8f8f8; /* Nền nhạt hơn */
                padding: 10px; /* Giảm padding của detail box */
                box-shadow: 0 2px 5px rgba(0, 71, 171, 0.08); /* Shadow nhẹ hơn */
                min-width: 150px; /* Giảm min-width */
            }
            .detail-label {
                font-size: 11pt; /* Giảm font cho label */
                color: #0047AB; /* Giữ màu cho label */
            }
            .detail-value {
                font-size: 12pt; /* Giảm font cho giá trị */
            }
            .items-table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0; /* Giảm margin */
                box-shadow: none; /* Bỏ shadow cho table */
                border-radius: 0; /* Bỏ bo góc */
                overflow: visible; /* Cho phép hiển thị border đầy đủ */
            }
            .items-table th {
                background-color: #0047AB; /* Giữ màu header */
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                color: white;
                padding: 10px 8px; /* Giảm padding header */
                font-size: 11pt; /* Giảm font header */
                text-align: left;
                font-weight: 600;
                border-right: 1px solid #002b6b; /* Thêm viền để phân tách cột */
            }
            .items-table th:last-child {
                border-right: none;
            }
            .items-table td {
                padding: 8px 8px; /* Giảm padding cell */
                font-size: 10pt; /* Giảm font cell */
                border-bottom: 1px solid #ddd; /* Border nhẹ hơn */
            }
            .stt, .quantity, .unit, .date { /* Căn giữa các cột cố định */
                text-align: center;
            }
            .signature-area {
                margin-top: 30px; /* Giảm margin trên */
                gap: 15px;
                justify-content: space-around; /* Phân bố đều hơn */
            }
            .signature-box {
                text-align: center;
                flex: none; /* Bỏ flex grow */
                min-width: 180px; /* Chiều rộng cố định cho box chữ ký */
            }
            .signature-box div { /* Giảm font cho chữ ký */
                font-size: 11pt;
            }
            .signature-line {
                border-top: 1px solid #0047AB;
                margin-top: 30px; /* Giảm margin trên cho đường kẻ */
                margin-bottom: 5px;
                padding-top: 3px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="Kho ảnh_Images_09d5aefa.Ảnh.061339.jpg" alt="Au Viet Construction Logo" class="header-logo">
            </div>
            <div class="company-info">
                <div class="company-name">CÔNG TY CỔ PHẦN ĐẦU TƯ VÀ XÂY DỰNG ÂU VIỆT</div>
                <div class="document-title">YÊU CẦU MUA HÀNG</div>
            </div>
            <div class="document-code">Mã: BM-2</div>
        </div>

        <div class="search-container">
            <div class="search-box">
                <input type="text" id="search-input" class="search-input" placeholder="Nhập mã YCMH...">
                <!-- Hộp gợi ý sẽ được thêm vào đây bằng JavaScript -->
                <button id="search-button" class="search-button">
                    <i class="fas fa-search"></i> Tìm kiếm
                </button>
            </div>
            <button id="print-button" class="print-button">
                <i class="fas fa-print"></i> In phiếu
            </button>
        </div>

        <div class="content">
            <div class="project-info">
                <div class="info-label">Công trình:</div>
                <div class="info-value" id="project-name"></div>
                
                <div class="info-label">Số YCMH:</div>
                <div class="info-value" id="request-code"></div>
            </div>

            <div class="request-details">
                <div class="detail-box">
                    <div class="detail-label">Ngày yêu cầu</div>
                    <div class="detail-value" id="request-date"></div>
                </div>
                <div class="detail-box">
                    <div class="detail-label">Lần ban hành</div>
                    <div class="detail-value" id="request-version">01</div>
                </div>
                <div class="detail-box">
                    <div class="detail-label">Bộ phận</div>
                    <div class="detail-value" id="request-department">Văn phòng</div>
                </div>
                <div class="detail-box">
                    <div class="detail-label">Tổng mặt hàng</div>
                    <div class="detail-value" id="total-items">0</div>
                </div>
            </div>

            <table class="items-table">
                <thead>
                    <tr>
                        <th class="stt">STT</th>
                        <th>Mặt hàng</th>
                        <th>Mô tả</th>
                        <th>Mục đích sử dụng</th>
                        <th>Đơn vị</th>
                        <th class="quantity">Số lượng</th>
                        <th class="date">Ngày nhập</th>
                        <th>Vị trí nhập</th>
                        <th>Thay đổi so với TK</th>
                    </tr>
                </thead>
                <tbody id="items-body">
                    <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                </tbody>
            </table>

            <div id="no-data" class="no-data">
                Không tìm thấy dữ liệu cho mã YCMH này.
            </div>

            <div class="signature-area">
                <div class="signature-box">
                    <div>NGƯỜI LẬP</div>
                    <div class="signature-line">(Ký, ghi rõ họ tên)</div>
                </div>
                <div class="signature-box">
                    <div>NGƯỜI KIỂM TRA</div>
                    <div class="signature-line">(Ký, ghi rõ họ tên)</div>
                </div>
                <div class="signature-box">
                    <div>NGƯỜI PHÊ DUYỆT</div>
                    <div class="signature-line">(Ký, ghi rõ họ tên)</div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div>Phiếu yêu cầu mua hàng - Công ty Cổ phần Đầu tư và Xây dựng Âu Việt</div>
            <div class="logo">
                <i class="fas fa-building logo-icon"></i>
                <div>Chất lượng tạo nên giá trị bền vững</div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <div>Đang tải dữ liệu...</div>
    </div>
    <div class="error" id="error"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const apiUrl = 'https://script.google.com/macros/s/AKfycbz45axkSa-92kz-vCqAQ1xwmRjlFWqX6b0v-B0ENI73UIa8M9RzCXDkSQtNcwhFX2FA/exec';
            const loadingElement = document.getElementById('loading');
            const errorElement = document.getElementById('error');
            const noDataElement = document.getElementById('no-data');
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const printButton = document.getElementById('print-button');
            const searchBoxElement = document.querySelector('.search-box'); // Lấy phần tử cha của input

            // Element cho gợi ý tìm kiếm
            const suggestionBox = document.createElement('div');
            suggestionBox.id = 'suggestions';
            searchBoxElement.appendChild(suggestionBox); // Thêm vào sau ô input

            let allData = null;
            let availableRequests = []; // Lưu danh sách các mã YCMH có sẵn
            
            // Lấy ID phiếu từ URL (nếu có)
            const urlParams = new URLSearchParams(window.location.search);
            const requestId = urlParams.get('id');
            if (requestId) {
                searchInput.value = requestId;
            }
            
            // Tải dữ liệu từ API
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Không thể kết nối đến server');
                    }
                    return response.json();
                })
                .then(data => {
                    loadingElement.style.display = 'none';
                    allData = data;
                    
                    // Xử lý dữ liệu để lấy danh sách gợi ý
                    if (allData && allData['Phiếu YCMH'] && Array.isArray(allData['Phiếu YCMH'].data)) {
                        availableRequests = allData['Phiếu YCMH'].data.map(item => item.ID);
                    }

                    // Nếu có mã YCMH trong URL, thực hiện tìm kiếm
                    if (requestId) {
                        searchRequest(requestId);
                    } else if (data && data['Phiếu YCMH'] && data['Phiếu YCMH'].data.length > 0) {
                        // Nếu không có mã, hiển thị phiếu đầu tiên (nếu có dữ liệu)
                        displayRequest(data['Phiếu YCMH'].data[0]);
                    } else {
                        // Nếu không có request ID và cũng không có dữ liệu nào để hiển thị mặc định
                        clearRequestData(); // Xóa sạch dữ liệu cũ
                        noDataElement.style.display = 'block'; // Hiển thị thông báo không có dữ liệu
                    }
                })
                .catch(error => {
                    loadingElement.style.display = 'none';
                    showError('Lỗi khi tải dữ liệu: ' + error.message);
                });
            
            // Xử lý sự kiện tìm kiếm
            searchButton.addEventListener('click', function() {
                const searchValue = searchInput.value.trim();
                if (searchValue) {
                    searchRequest(searchValue);
                } else {
                    showError('Vui lòng nhập mã YCMH để tìm kiếm');
                }
                suggestionBox.style.display = 'none'; // Ẩn gợi ý sau khi tìm kiếm
            });
            
            // Xử lý sự kiện nhấn Enter trong ô tìm kiếm
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchButton.click();
                }
            });

            // Xử lý sự kiện gõ vào ô tìm kiếm để hiển thị gợi ý
            searchInput.addEventListener('input', function() {
                const searchValue = this.value.trim().toLowerCase();
                suggestionBox.innerHTML = ''; // Xóa gợi ý cũ
                suggestionBox.style.display = 'none'; // Ẩn nếu không có gì khớp

                if (searchValue.length > 0 && availableRequests.length > 0) {
                    const filteredRequests = availableRequests.filter(reqId => 
                        reqId.toLowerCase().includes(searchValue)
                    );
                    
                    if (filteredRequests.length > 0) {
                        filteredRequests.forEach(reqId => {
                            const suggestionItem = document.createElement('div');
                            suggestionItem.textContent = reqId;
                            suggestionItem.addEventListener('mouseover', function() {
                                this.style.backgroundColor = '#f0f7ff';
                            });
                            suggestionItem.addEventListener('mouseout', function() {
                                this.style.backgroundColor = 'white';
                            });
                            
                            // Khi click vào gợi ý
                            suggestionItem.addEventListener('click', function() {
                                searchInput.value = this.textContent;
                                suggestionBox.style.display = 'none';
                                searchRequest(this.textContent); // Tự động tìm kiếm khi chọn gợi ý
                            });
                            
                            suggestionBox.appendChild(suggestionItem);
                        });
                        suggestionBox.style.display = 'block'; // Hiển thị hộp gợi ý
                    }
                }
            });

            // Ẩn gợi ý khi click ra ngoài ô input hoặc hộp gợi ý
            document.addEventListener('click', function(event) {
                // Kiểm tra xem sự kiện click có xảy ra bên ngoài ô input và hộp gợi ý hay không
                if (!searchInput.contains(event.target) && !suggestionBox.contains(event.target)) {
                    suggestionBox.style.display = 'none';
                }
            });
            
            // Xử lý sự kiện in phiếu
            printButton.addEventListener('click', function() {
                window.print();
            });
            
            // Hàm tìm kiếm phiếu yêu cầu
            function searchRequest(requestId) {
                if (!allData) return;
                
                loadingElement.style.display = 'none';
                errorElement.style.display = 'none';
                noDataElement.style.display = 'none';
                
                if (allData['Phiếu YCMH'] && Array.isArray(allData['Phiếu YCMH'].data)) {
                    const requestData = allData['Phiếu YCMH'].data.find(
                        item => item.ID && item.ID.toLowerCase() === requestId.toLowerCase()
                    );
                    
                    if (requestData) {
                        displayRequest(requestData);
                    } else {
                        clearRequestData();
                        noDataElement.style.display = 'block';
                    }
                } else {
                    showError('Dữ liệu phiếu YCMH không hợp lệ.');
                }
            }
            
            // Hiển thị thông tin phiếu yêu cầu
            function displayRequest(requestData) {
                document.getElementById('project-name').textContent = requestData['Tên công trình'] || '';
                document.getElementById('request-code').textContent = requestData.ID || '';
                
                // Xử lý ngày tháng
                const requestDate = requestData['Ngày yêu cầu'] ? 
                    new Date(requestData['Ngày yêu cầu']).toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' }) : 
                    new Date().toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });
                document.getElementById('request-date').textContent = requestDate;
                
                // Lọc và hiển thị chi tiết phiếu yêu cầu
                if (allData['YCMH chi tiết'] && Array.isArray(allData['YCMH chi tiết'].data)) {
                    const details = allData['YCMH chi tiết'].data.filter(
                        item => item['Mã phiếu YCMH'] === requestData.ID
                    );
                    
                    const itemsBody = document.getElementById('items-body');
                    itemsBody.innerHTML = '';
                    
                    // Cập nhật tổng số mặt hàng
                    document.getElementById('total-items').textContent = details.length;
                    
                    if (details.length > 0) {
                        details.forEach((item, index) => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="stt">${item.STT || (index + 1)}</td>
                                <td>${item['Mặt hàng'] || ''}</td>
                                <td>${item['Mô tả'] || ''}</td>
                                <td>${item['Mục đích sử dụng'] || ''}</td>
                                <td class="unit">${item['Đơn vị tính'] || ''}</td>
                                <td class="quantity">${item['Số lượng'] || ''}</td>
                                <td class="date">${item['Ngày nhập hàng'] ? 
                                    new Date(item['Ngày nhập hàng']).toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' }) : ''}</td>
                                <td>${item['Vị trí nhập hàng'] || ''}</td>
                                <td>${item['Thay đổi so với TK'] || ''}</td>
                            `;
                            itemsBody.appendChild(row);
                        });
                        noDataElement.style.display = 'none'; // Ẩn thông báo nếu có dữ liệu chi tiết
                    } else {
                        noDataElement.style.display = 'block';
                    }
                } else {
                    showError('Không có dữ liệu chi tiết cho phiếu yêu cầu này hoặc dữ liệu chi tiết không hợp lệ.');
                    noDataElement.style.display = 'block'; // Hiển thị thông báo không có dữ liệu chi tiết
                }
            }
            
            // Xóa dữ liệu hiện tại trên giao diện
            function clearRequestData() {
                document.getElementById('project-name').textContent = '';
                document.getElementById('request-code').textContent = '';
                document.getElementById('request-date').textContent = '';
                document.getElementById('total-items').textContent = '0';
                document.getElementById('items-body').innerHTML = '';
            }
                
            function showError(message) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                // Đảm bảo các phần khác bị ẩn khi có lỗi
                loadingElement.style.display = 'none';
                noDataElement.style.display = 'none';
                document.getElementById('items-body').innerHTML = ''; // Xóa bảng nếu có lỗi
            }
        });
    </script>
</body>
</html>
