<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Đặt hàng phần mềm theo yêu cầu | UPCODE</title>

  <link rel="icon" type="image/png" href="logo 1.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary:#2563eb; --primary-dark:#1d4ed8; --primary-light:#dbeafe;
      --secondary:#10b981; --accent:#f59e0b; --bg:#f8fafc; --card:#ffffff;
      --text:#1e293b; --text-light:#64748b; --footer-bg:#111827; --footer-text:#9ca3af;
      --border:#e2e8f0; --success:#16a34a; --success-bg:#f0fdf4; --error:#e11d48; --error-bg:#fff1f2;
      --shadow-sm:0 1px 2px rgba(0,0,0,.05); --shadow-md:0 4px 6px rgba(0,0,0,.1); --shadow-lg:0 10px 25px rgba(0,0,0,.1);
      --radius:12px; --transition:all .3s ease;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;display:flex;flex-direction:column}
    .container{max-width:1200px;margin:0 auto;padding:0 20px;width:100%}

    header{background:#fff;color:var(--text);padding:16px 0;box-shadow:var(--shadow-md);position:sticky;top:0;z-index:100;border-bottom:1px solid var(--border)}
    .header-content{display:flex;align-items:center;justify-content:space-between}
    a.logo-container{display:flex;align-items:center;gap:12px;text-decoration:none}
    .logo{height:48px;width:auto;transition:var(--transition)}
    a.logo-container:hover .logo{transform:scale(1.1) rotate(-5deg)}
    .company-name{font-weight:700;font-size:24px;color:var(--primary)}
    .main-nav{display:flex;align-items:center;gap:16px}
    .nav-links a{text-decoration:none;color:var(--text-light);font-weight:500;padding:8px 16px;border-radius:8px;transition:var(--transition)}
    .nav-links a:hover{color:var(--primary);background:var(--primary-light)}
    .header-cta{padding:10px 20px;background:var(--primary);color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:var(--transition);box-shadow:var(--shadow-sm)}
    .header-cta:hover{background:var(--primary-dark);box-shadow:var(--shadow-md);transform:translateY(-2px)}

    .main{flex:1;padding:50px 0 40px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow-lg);padding:40px;margin-bottom:32px;position:relative;overflow:hidden;transition:var(--transition)}
    .card:hover{transform:translateY(-5px);box-shadow:0 15px 30px rgba(0,0,0,.15)}
    .card-header{margin-bottom:32px;position:relative;text-align:center}
    .card-header::after{content:'';position:absolute;bottom:-16px;left:50%;transform:translateX(-50%);width:80px;height:4px;background:linear-gradient(90deg,var(--primary),var(--secondary));border-radius:2px}
    h1{font-size:32px;font-weight:700;color:var(--text);margin:0 0 12px}
    .lead{color:var(--text-light);font-size:18px;margin-top:0;font-weight:400}

    .form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:24px}
    .form-group{margin-bottom:24px;position:relative}
    label{display:block;font-weight:600;margin-bottom:10px;color:var(--text);display:flex;align-items:center;gap:6px}
    .req::after{content:"*";color:#ef4444}
    input,select,textarea{width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:10px;font-size:16px;background:#fff;transition:var(--transition)}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(37,99,235,.1)}
    textarea{min-height:120px;resize:vertical}
    .note{font-size:15px;color:var(--text-light);margin-top:24px;text-align:center;padding:12px;background:var(--bg);border-radius:8px}

    .btn{background:linear-gradient(120deg,var(--primary),var(--primary-dark));color:#fff;padding:16px 32px;border:none;border-radius:10px;font-weight:600;font-size:17px;cursor:pointer;transition:var(--transition);display:inline-flex;align-items:center;justify-content:center;gap:10px;box-shadow:var(--shadow-md)}
    .btn:hover{background:linear-gradient(120deg,var(--primary-dark),var(--primary));transform:translateY(-2px);box-shadow:0 6px 15px rgba(37,99,235,.3)}
    .btn:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}

    /* Repeater */
    .feature-list{display:grid;gap:12px}
    .feature-row{display:grid;grid-template-columns:1fr 1fr auto;gap:12px;align-items:end}
    .feature-row .remove-btn{padding:12px 16px;border:2px solid var(--border);border-radius:8px;background:#fff;cursor:pointer}
    .add-feature-btn{margin-top:8px}

    /* Popup */
    .popup-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:opacity .25s ease,visibility 0s .25s}
    .popup-overlay.show{opacity:1;visibility:visible}
    .popup-box{background:#fff;padding:36px;border-radius:16px;box-shadow:var(--shadow-lg);text-align:center;max-width:460px;width:90%;transform:scale(.96);transition:transform .25s ease}
    .popup-overlay.show .popup-box{transform:scale(1)}
    .popup-icon{width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 18px;font-size:36px}
    .popup-icon.success{background:var(--success-bg);color:var(--success)}
    .popup-icon.error{background:var(--error-bg);color:var(--error)}
    .popup-title{font-size:24px;font-weight:800;margin-bottom:10px;color:var(--text)}
    .popup-message{color:var(--text-light);margin-bottom:22px}
    .popup-close-btn{padding:12px 28px;font-size:16px;font-weight:700;border-radius:10px;border:none;cursor:pointer}
    .popup-close-btn.success{background:var(--success);color:#fff}
    .popup-close-btn.error{background:var(--error);color:#fff}

    /* ▼▼▼ PHẦN CSS FOOTER ĐƯỢC CHỈNH SỬA ▼▼▼ */
    footer{background:var(--footer-bg);color:var(--footer-text);padding:60px 0 24px;margin-top:auto}
    .footer-content{display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:40px;margin-bottom:40px}
    .footer-about .footer-logo{height:40px;margin-bottom:16px}
    .footer-about p { margin-bottom: 20px; }
    .footer-heading{font-weight:600;margin-bottom:20px;font-size:18px;color:#fff;position:relative}
    .footer-heading::after{content:'';position:absolute;left:0;bottom:-8px;width:30px;height:2px;background:var(--primary)}
    .footer-links{list-style:none}.footer-links li{margin-bottom:12px}
    .footer-links a{color:var(--footer-text);text-decoration:none;transition:var(--transition);display:inline-block;}
    .footer-links a:hover{color:#fff;transform: translateX(5px);}
    .social-links{display:flex;gap:16px;margin-top:24px}
    .social-links a{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;background:#374151;color:#fff;transition:var(--transition)}
    .social-links a:hover{background:var(--primary);transform:translateY(-3px)}
    .footer-bottom{border-top:1px solid #374151;padding-top:24px;text-align:center;font-size:14px}
    .footer-contact-info li { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px; }
    .footer-contact-info i { margin-top: 4px; color: var(--primary); }
    /* ▲▲▲ KẾT THÚC PHẦN CSS FOOTER ĐƯỢC CHỈNH SỬA ▲▲▲ */

    @media (max-width:968px){.nav-links{display:none}.form-grid{grid-template-columns:1fr;gap:0}}
    @media (max-width:768px){.footer-content{text-align:center;} .footer-heading::after{left:50%;transform:translateX(-50%)} .social-links{justify-content:center} .footer-contact-info li { justify-content: center; }}
    @media (max-width:640px){.header-content{flex-direction:column;gap:16px}h1{font-size:28px}}

    /* ▼▼ CHỈNH 2 HÀNG CHO TEXTAREA TÍNH NĂNG / GHI CHÚ ▼▼ */
    .feature-text, .note-text {
      min-height: 48px !important;   /* ~2 hàng */
      font-size: 15px;
      padding: 6px 10px;
      resize: vertical;
    }
  </style>
</head>
<body>
<header>
  <div class="container header-content">
    <a href="#" class="logo-container">
      <img src="logo 1.png" alt="UPCODE Logo" class="logo" onerror="this.style.display='none'">
      <div class="company-name">UPCODE</div>
    </a>
    <nav class="main-nav">
      <div class="nav-links">
        <a href="#">Dịch vụ</a><a href="#">Về chúng tôi</a><a href="#">Liên hệ</a>
      </div>
      <button class="header-cta">Nhận báo giá</button>
    </nav>
  </div>
</header>

<main class="main">
  <div class="container">
    <div class="card">
      <div class="form-content">
        <div class="card-header">
          <h1>Đặt hàng phần mềm theo yêu cầu</h1>
          <p class="lead">Mô tả nhu cầu của bạn, chúng tôi sẽ liên hệ tư vấn và báo giá trong vòng 24h</p>
        </div>

        <form id="orderForm">
          <div class="form-grid">
            <div class="form-group">
              <label><i class="fas fa-building"></i> <span class="req">Tên công ty / cá nhân</span></label>
              <input name="company" required placeholder="VD: Công ty ABC / Nguyễn Văn A" />
            </div>
           <div class="form-group">
            <label><i class="fas fa-briefcase"></i> <span class="req">Lĩnh vực kinh doanh</span></label>
            <input name="business_field" required placeholder="VD: Bán lẻ, Vận tải, Giáo dục..." />
          </div>
        </div>


          <div class="form-grid">
            <div class="form-group">
              <label><i class="fas fa-user"></i> <span class="req">Người liên hệ</span></label>
              <input name="contact_name" required placeholder="Họ tên" />
            </div>
            <div class="form-group">
              <label><i class="fas fa-phone"></i> <span class="req">Số điện thoại</span></label>
              <input name="phone" required placeholder="09xx..." />
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label><i class="fas fa-envelope"></i> Email</label>
              <input name="email" type="email" placeholder="you@example.com" />
            </div>
            <div class="form-group">
              <label><i class="fas fa-money-bill-wave"></i> Ngân sách dự kiến (VNĐ)</label>
              <input name="budget" placeholder="VD: 50.000.000" />
            </div>
          </div>

          <div class="form-group">
            <label><i class="fas fa-calendar-alt"></i> Hạn mong muốn</label>
            <input name="deadline" type="date" />
          </div>

          <div class="form-group">
            <label><i class="fas fa-sticky-note"></i> Ghi chú chung</label>
            <textarea name="general_notes" placeholder="Ví dụ: tích hợp với hệ thống hiện có, ưu tiên mobile, yêu cầu bảo mật..."></textarea>
          </div>

          <!-- Danh sách tính năng -->
          <div class="form-group">
            <label><i class="fas fa-list-check"></i> <span class="req">Danh sách tính năng</span></label>
            <div id="featureList" class="feature-list"></div>

            <button type="button" class="btn add-feature-btn" onclick="addFeatureRow()">
              <i class="fas fa-plus"></i> Thêm tính năng
            </button>
          </div>

          <div class="note">
            <i class="fas fa-info-circle"></i> Bằng cách gửi, bạn đồng ý cho phép chúng tôi lưu thông tin để tư vấn và báo giá.
          </div>

          <div style="text-align:center;margin-top:32px;">
            <button class="btn" id="submitBtn" type="submit">
              <i class="fas fa-paper-plane"></i> Gửi yêu cầu
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>

<!-- ▼▼▼ PHẦN HTML FOOTER ĐƯỢC CHỈNH SỬA ▼▼▼ -->
<footer>
  <div class="container">
    <div class="footer-content">
      <div class="footer-about">
        <a href="#"><img src="logo 1.png" alt="UPCODE Logo" class="footer-logo" onerror="this.style.display='none'"></a>
        <p>Chúng tôi biến ý tưởng của bạn thành các giải pháp công nghệ sáng tạo, hiệu quả và có khả năng mở rộng.</p>
        <div class="social-links">
          <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
          <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
          <a href="#" aria-label="Zalo"><i class="fa-solid fa-comment-dots"></i></a>
        </div>
      </div>

      <div>
        <h3 class="footer-heading">Dịch vụ</h3>
        <ul class="footer-links">
          <li><a href="#">Phát triển Web App</a></li>
          <li><a href="#">Phát triển Mobile App</a></li>
          <li><a href="#">Giải pháp UI/UX Design</a></li>
          <li><a href="#">Tư vấn chuyển đổi số</a></li>
        </ul>
      </div>

      <div>
        <h3 class="footer-heading">Liên kết</h3>
        <ul class="footer-links">
          <li><a href="#">Về chúng tôi</a></li>
          <li><a href="#">Dự án đã làm</a></li>
          <li><a href="#">Câu hỏi thường gặp</a></li>
          <li><a href="#">Chính sách bảo mật</a></li>
        </ul>
      </div>
      
      <div>
        <h3 class="footer-heading">Liên hệ</h3>
        <ul class="footer-links footer-contact-info">
          <li>
            <i class="fas fa-map-marker-alt"></i>
            <span>Hà Nội</span>
          </li>
          <li>
            <i class="fas fa-phone"></i>
            <a href="tel:0785210333">0785.210.333</a>
          </li>
          <li>
            <i class="fas fa-envelope"></i>
            <a href="mailto:info@upcode.com">info@upcode.com</a>
          </li>
        </ul>
      </div>
    </div>

  </div>
</footer>
<!-- ▲▲▲ KẾT THÚC PHẦN HTML FOOTER ĐƯỢC CHỈNH SỬA ▲▲▲ -->


<!-- Popup -->
<div id="popup-overlay" class="popup-overlay">
  <div id="popup-box" class="popup-box">
    <div id="popup-icon" class="popup-icon"></div>
    <h2 id="popup-title" class="popup-title"></h2>
    <p id="popup-message" class="popup-message"></p>
    <button id="popup-close-btn" class="popup-close-btn"></button>
  </div>
</div>

<script>
  /* ====== ĐỔI URL WEBHOOK n8n Ở ĐÂY ====== */
  const N8N_WEBHOOK_URL = 'https://asia-hn.n8nhosting.cloud/webhook/39bacc3c-b33a-4c32-8898-ae85a312c4cc';

  const form = document.getElementById('orderForm');
  const btn = document.getElementById('submitBtn');

  // Popup helpers
  const popupOverlay = document.getElementById('popup-overlay');
  const popupIcon = document.getElementById('popup-icon');
  const popupTitle = document.getElementById('popup-title');
  const popupMessage = document.getElementById('popup-message');
  const popupCloseBtn = document.getElementById('popup-close-btn');

  function showPopup(type, title, message) {
    popupTitle.textContent = title;
    popupMessage.innerHTML = message;
    popupIcon.className = 'popup-icon ' + (type === 'success' ? 'success' : 'error');
    popupIcon.innerHTML = type === 'success' ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>';
    popupCloseBtn.className = 'popup-close-btn ' + (type === 'success' ? 'success' : 'error');
    popupCloseBtn.textContent = type === 'success' ? 'OK' : 'Thử lại';
    popupOverlay.classList.add('show');
  }
  function hidePopup(){ popupOverlay.classList.remove('show'); }
  popupCloseBtn.addEventListener('click', hidePopup);
  popupOverlay.addEventListener('click', (e)=>{ if(e.target===popupOverlay) hidePopup(); });

  // Repeater (1 dòng mặc định)
  function addFeatureRow(featureVal="", noteVal=""){
    const list = document.getElementById('featureList');
    const row = document.createElement('div');
    row.className = 'feature-row';
    row.setAttribute('data-row','');
    row.innerHTML = `
      <div>
        <label style="font-weight:600;margin-bottom:6px;display:block;">Tính năng</label>
        <textarea data-feature class="feature-text" rows="2" placeholder="VD: Quản lý đơn hàng" required></textarea>
      </div>
      <div>
        <label style="font-weight:600;margin-bottom:6px;display:block;">Ghi chú</label>
        <textarea data-note class="note-text" rows="2" placeholder="VD: Cho phép import Excel"></textarea>
      </div>
      <button type="button" class="remove-btn" onclick="removeFeatureRow(this)">
        <i class="fas fa-trash"></i>
      </button>`;
    list.appendChild(row);
    if (featureVal) row.querySelector('[data-feature]').value = featureVal;
    if (noteVal) row.querySelector('[data-note]').value = noteVal;
  }
  function removeFeatureRow(btn){
    const list = document.getElementById('featureList');
    const rows = list.querySelectorAll('[data-row]');
    if (rows.length <= 1){
      const r = btn.closest('[data-row]');
      r.querySelector('[data-feature]').value = '';
      r.querySelector('[data-note]').value = '';
      return;
    }
    btn.closest('[data-row]').remove();
  }

  // Gom thành 1 biến lớn: features = [ {feature, note}, ... ]
function buildFeaturesArray(){
  const rows = Array.from(document.querySelectorAll('#featureList [data-row]'));
  const arr = [];
  rows.forEach((r, i) => {
    const f = (r.querySelector('[data-feature]').value||'').trim();
    const n = (r.querySelector('[data-note]').value||'').trim();
    if(f) arr.push({ index: i+1, feature: f, note: n });
  });
  return arr;
}


  // Fire-and-forget: ưu tiên sendBeacon → fallback no-cors (không cần CORS server)
  function sendFireAndForgetJSON(url, payload){
    try{
      if(navigator.sendBeacon){
        const blob = new Blob([JSON.stringify(payload)], {type:'application/json'});
        if(navigator.sendBeacon(url, blob)) return true;
      }
    }catch(_){}
    try{
      fetch(url, { method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
      return true;
    }catch(_){}
    return false;
  }

  // Mã đơn tạm hiển thị ngay
  function genClientOrderId(){
    const now=Date.now(); const d=new Date(now).toISOString().slice(0,10).replace(/-/g,'');
    return `ORD-${d}-${(now%9000+1000)}`;
  }

  form.addEventListener('submit', (e)=>{
    e.preventDefault();

    const raw = Object.fromEntries(new FormData(form).entries());
    const features = buildFeaturesArray();
    if (features.length === 0){
      showPopup('error','Thiếu dữ liệu','Vui lòng nhập ít nhất 1 tính năng.');
      return;
    }

    const payload = {
      ...raw,
      features,
      user_agent: navigator.userAgent||'',
      order_id: genClientOrderId()
    };

    const sent = sendFireAndForgetJSON(N8N_WEBHOOK_URL, payload);

    if (sent){
      showPopup('success','Đã nhận yêu cầu',`Mã tạm: <strong>${payload.order_id}</strong>. Chúng tôi sẽ liên hệ sớm.`);
      form.reset();
      document.getElementById('featureList').innerHTML = '';
      addFeatureRow(); // luôn để sẵn 1 dòng
    } else {
      showPopup('error','Không thể gửi','Vui lòng kiểm tra kết nối mạng và thử lại.');
    }
  });

  // Khởi tạo: 1 dòng tính năng mặc định
  addFeatureRow();
</script>
</body>
</html>
